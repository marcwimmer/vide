#!/bin/bash
echo "Extracting file into /tmp"
echo "Installing for $(whoami)"
set -e

# searches for the line number where finish the script and start the tar.gz
SKIP=`awk '/^__TARFILE_FOLLOWS__/ { print NR + 1; exit 0; }' $0`
#remember our file name
DIR=$(cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd)
SCRIPTNAME=$(basename $(readlink -nf $0))

echo "This is we: $DIR/$SCRIPTNAME"

# take the tarfile and pipe it into tar
mkdir /tmp/vimmy
tail -n +$SKIP $DIR/$SCRIPTNAME | tar -xz -C /tmp/vimmy
cd /tmp/vimmy
ls -lha /tmp/vimmy
sleep 3

echo copying vim to local folder
find /tmp/|grep vim-mysettings
sleep 50
du -sh /tmp/vimmy/.vim-mysettings
rsync /tmp/vimmy/.vim ~/ -arv
rsync /tmp/vimmy/.vimrc ~/ -arv

cd ~
ls -lha .vim-mysettings
find .|grep .vimrc
rm .vim
rm .vimrc
ln -s .vim-mysettings/.vim
ln -s .vim-mysettings/plugins/vim-mysettings/.vimrc

echo copying vim to home dir
cp /tmp/vimmy/vim ~/vim

#rm -Rf /tmp/vimmy

echo "Adding cronjob to update vim packages"
if [ ! $(grep -q vimupdate ~/.bashrc) ]; then
	echo '~/.vimupdate &' >> ~/.bashrc
fi


# Any script here will happen after the tar file extract.
echo "Finished"
exit 0
# NOTE: Don't place any newline characters after the last line below.
__TARFILE_FOLLOWS__
