#!/bin/bash
set -e
set -x

echo 'Downloading extra software'

#./download # done in docker file
ls -lhtar /
/compile

rsync /opt/clone_vimmysettings/ /opt/clone/vim-my-settings/ -ar --delete

# build tar 
rm -Rf ~/.vim &>/dev/null || true
mkdir -p ~/.vim
ln -s /opt/clone ~/.vim/bundle
ln -s /opt/clone_UltiSnips/ ~/.vim/UltiSnips

cd ~
cp /usr/local/bin/ag ~/.vim/ag
time tar cfh /tmp/files.tar .vim

# add vim executable
tar --append --file /tmp/files.tar -C /usr/bin vim

# add vim packages
cd /tmp
tar cfz /tmp/vim.share -C /tmp/vim runtime
tar --append --file /tmp/files.tar -C /tmp vim.share

#tar to gzipped tar
time gzip /tmp/files.tar

cat /opt/decompression_script /tmp/files.tar.gz > /tmp/marcvim_installer.sh
chmod a+x /tmp/marcvim_installer.sh
